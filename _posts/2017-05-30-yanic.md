---
layout: post
title:  "Monitoring im Freifunk (yanic)"
author: genofire
date:   2017-05-30 13:41:17 +0200
---
Mit der neuen Webseite hat sich auch vieles in Bereich Monitoring verändert.


## Hintergrund
In der Vergangenheit gab es die Software Alfred, um von den Knoten Information zu bekommen.
Doch diese Software wird von Gluon aus technischen Gründen bald nicht mehr weiter entwickelt.
Bereits anfang letztes Jahr, wurde in Gluon mit der neuen Statusseite einiges an Bereitstellung von Information umgebaut.
Die dadurch entstandene Software **respondd**, wird genutzt um die Nachbarknoten zu finden und um die Startseite zu füllen.


## Entwicklung
Durch den unausgesprochenen Status, dass Alfred deprecated ist, musste nun ein Ersatz her.
Hierfür kamen Corny und ich auf die Idee, dafür eine Software zu entwickeln.
Die Wahl der Sprache viel aus mehreren Gründen auf go.

Als Datenbank zum Abspeichern der Werte fiel die Wahl auf [InfluxDB](https://docs.influxdata.com/influxdb/latest/). Sie ist zum Abspeichern von Messwerten über die Zeit gedacht, benutzt eine Sprache angelehnt an SQL und bietet eine Bibliothek für go.
Zudem sollte die Software auch die Möglichkeit bieten, die Daten für eine [Karten Software](https://github.com/ffnord/meshviewer) vorbereitet zu liefern.
Und weitere Anforderungen, welche in Zukunft noch kommen könnten und die Informationen von den Knoten erfragen, würde.

Auf der Breminale fand der erste große Test statt.
Dort hat die Software seine Aufgabe bereits sehr gut erfüllt.
Es sind allerdings kleine Probleme aufgetaucht, die den direkten Einsatz im Freifunk Bremen verzögerten.
Die Bestanden hautpsächlich aus zeitlichen Verarbeitung.
Dies lag vorallem an die verbindungslosen Kommunikation in respondd Daten austauscht.
Um diese Probleme noch genauer und über ein längeren Zeitraum zu berachten, haben wir zunächst eine kleine Instance zum entwickeln im Freifunk aufgesetzt.
Zur Lösung führen verschiedene Mechanismen in unsere Software.
Doch auch die Gluon-Entwickler haben unabhängig von uns in respondd einer [Verbesserungen](https://github.com/freifunk-gluon/packages/pull/140) dieses Problemes entwickelt.

Zum Zeitpunkt der Veröffentlichung der neuen Webseite, hielten wir unsere Software für ausgereift, um mit der neuen Webseite Sie hauptsächlich einzusetzen und damit Alfred abzuschaffen.


Der Name selbst war zunächst respondd-collector, dieser wurde auf Wunsch und längere [Diskussion]() umgenannt.
Der neue Name war Yanic und bedeutet "Yet another node info collector", da es zu dem Zeitpunkt auch aus anderen Communities ähnliche Software entstanden ist.
Die verbreitetste Software ist wohl [Hopglass](https://github.com/hopglass).


### Auswirkung unsere Entwicklung auf andere Communities
Zuletzt gab es eine große Änderung in der Struktur von Yanic,
damit andere Communities nun Pull-Request erstellen können,
um deren favorisierte Datenbank mit yanic zu füllen.
Momentan wird an einem PR für Elasticsearch entwickeln.

Denn durch die moderne grafische Aufbereitung von Grafana,
haben ein paar Communities bereits Interesse an unsere Software geäußert.

Nach aktuellem Wissensstand nutzen folgende Communities bereits Yanic:
- [Freifunk in Mainz, Wiesbaden & Umgebung](https://blog.freifunk-mainz.de/tag/karte/)
- [Freifunk Regensburg](https://regensburg.freifunk.net/meshviewer/)
- [Freifunk Frankfurt am Main](https://ffm.freifunk.net/2017/05/10/wartungsarbeiten-beendet/)
- [Freifunk Westpfalz](https://stats.freifunk-westpfalz.de/)
- [Freifunk Ulzen](https://www.freifunk-uelzen.de/2017/05/06/kartenserver/)
- und wahrscheinlich von vielen, von den wir es nicht wissen :D

Auch die freundschaftliche Konkurenz, die nach Alfred Hopglass entwickeln,
äußern mit einen Fork auch Interesse an [Yanic](https://github.com/hopglass/yanic).

## Darstellung als Graphen
Wie bereits erwähnt, ist Grafana ein sehr gutes modernes Tool zur Darstellung von Graphen.

Hier mal, um höchstens fünf Minuten verzögerte eine Live-Darstellung unseres Netzes direkt von [Grafana](https://grafana.bremen.freifunk.net/):
<img src="https://grafana.bremen.freifunk.net/render/dashboard-solo/db/globals?panelId=2&orgId=1&from=now-23h&to=now&width=1000&height=500&theme=light"/>

Dies und vieles mehr kann man nun mit den eingesammelten Daten. Ihr dürft Euch auch gern dort mal austoben, eine Registrierung ist nicht notwendig. Der Benutzer lautet “ffhb” und das Passwort “wellenfunk”, doch Bitte beachtet folgende Regeln.
Lässt Eure Dashboards mit "[Privat]" anfangen, und verändert keine Dashboards von anderen und die Dashboards ohne "[Privat]" auch nicht ohne Einverständniserklärung der Bremer Communitie (die man gern im IRC, Maillingliste oder auf ein Treffen erfragen kann).<br/>
*(Falls diese Regeln nicht funktionieren, müssen wir leider eine verpflichtete Authentifizierung einführen)*

### Tipp
Es wurde oft angeregt, eine Software einzurichten, welche bei ausfallenden Knoten einem benachrichtigt.
Dies ist tatsächlich mit Grafana sehr rudimentär (und etwas kompliziert) möglich.

Indem man unter Alerting eine eigene E-Mail Eintrag erstellt.
Daraufhin auf sein Dashboard in ein Graphe, als Alert einen Grenzwert setzt und eine Benachrichtigung zu seiner zuvor angegeben Kontakt angibt.<br/>
*Beachtet: Einmal sind Mail-Adressen frei zugänglich. Außerdem könnten durch "Schwankungen" im Freifunk viele E-Mails ankommen.*

Die offizielle Anleitung von Grafana auf [Englisch](http://docs.grafana.org/alerting/rules/).

---
*Tut mir leid, dass es zu diesem Thema erst jetzt einen Beitrag gibt.
(Leider nimmt die Entwicklung sehr viel Zeit in Anspruch, wodurch ich auch in anderen Freifunk Angelegenheiten etwas weniger präsent bin.)*

Ihr könnt Euch schon mal freuen, dass hoffentlich bald einen weiteren Beitrag zur aktuellen [Karte](https://map.bremen.freifunk.net) geben wird.
